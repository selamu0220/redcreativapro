"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[23],{8794:(e,t,r)=>{r.d(t,{A:()=>l,AuthProvider:()=>o});var a=r(95155),s=r(12115),i=r(93536);let n=(0,s.createContext)(void 0),o=e=>{let{children:t}=e,[r,o]=(0,s.useState)(null),[l,u]=(0,s.useState)(!0),[d,c]=(0,s.useState)(!1),[m,p]=(0,s.useState)(null);console.log("AuthProvider: Rendering with loading:",l,"user:",r?"exists":"null");let f=(0,s.useCallback)(async e=>{try{let r;u(!0);let{data:a,error:s}=await i.N.from("users").select("*").eq("id",e.id).single();if(s&&"PGRST116"!==s.code)return void console.error("Error loading profile:",s);if(a)r=a;else{var t;let a={id:e.id,email:e.email,full_name:(null==(t=e.user_metadata)?void 0:t.full_name)||e.email.split("@")[0],subscription_tier:"free",subscription_status:"free",subscription_end_date:null},{data:s,error:n}=await i.N.from("users").insert(a).select().single();if(n)return void console.error("Error creating profile:",n);r=s}let n={id:r.id,email:r.email,name:r.full_name,subscriptionType:r.subscription_tier,subscriptionEndDate:r.subscription_end_date?new Date(r.subscription_end_date):null,dailyUsage:{date:new Date().toISOString().split("T")[0],aiRequests:0,promptsUsed:0,scriptsGenerated:0},dailyLimits:{aiRequests:100,promptsUsed:20,scriptsGenerated:5}};o(n)}catch(e){console.error("Error in loadUserProfile:",e),o(null)}finally{u(!1)}},[]);(0,s.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("demo_auth"),t=localStorage.getItem("demo_user");if("true"===e&&t)try{let e=JSON.parse(t);o(e),u(!1),console.log("AuthProvider: Demo mode initialized with user:",e);return}catch(e){console.error("Error parsing demo user:",e),localStorage.removeItem("demo_auth"),localStorage.removeItem("demo_user")}let{data:{session:r}}=await i.N.auth.getSession();if(null==r?void 0:r.user)try{await f(r.user)}catch(e){console.error("Error loading user profile on session check:",e)}}catch(e){console.error("Error initializing auth:",e)}finally{u(!1)}})();let{data:{subscription:e}}=i.N.auth.onAuthStateChange(async(e,t)=>{if("SIGNED_IN"===e&&(null==t?void 0:t.user))try{await f(t.user),c(!1),p(null)}catch(e){console.error("Error loading user profile on auth change:",e)}else"SIGNED_OUT"===e&&(o(null),c(!1),p(null))});return()=>e.unsubscribe()},[f]);let h=(0,s.useCallback)(()=>!!r&&("free"===r.subscriptionType||!r.subscriptionEndDate||new Date<r.subscriptionEndDate),[r]),g=(0,s.useCallback)(()=>{if(!r||!r.subscriptionEndDate)return 0;let e=new Date;return Math.max(0,Math.ceil((r.subscriptionEndDate.getTime()-e.getTime())/864e5))},[r]),x=(0,s.useCallback)(async(e,t)=>{try{let{data:r,error:a}=await i.N.auth.signInWithPassword({email:e,password:t});if(a){if(a.message.includes("Email not confirmed"))throw c(!0),p(e),Error("Email not confirmed");if(a.message.includes("Invalid login credentials"))throw Error("Invalid login credentials");throw a}r.user&&(c(!1),p(null),await f(r.user))}catch(e){throw console.error("Login error:",e),Error(e.message||"Error al iniciar sesi\xf3n")}},[f]),b=(0,s.useCallback)(async()=>{try{let e=localStorage.getItem("demo_auth");if("true"===e){localStorage.removeItem("demo_auth"),localStorage.removeItem("demo_user"),o(null);return}let{error:t}=await i.N.auth.signOut();if(t)throw t;o(null)}catch(e){throw console.error("Logout error:",e),Error(e.message||"Error al cerrar sesi\xf3n")}},[]),v=(0,s.useCallback)(async(e,t,r)=>{try{let{data:a,error:s}=await i.N.auth.signUp({email:e,password:t,options:{data:{full_name:r}}});if(s)throw s;console.log("Signup successful, verification email sent to:",e),c(!0),p(e),a.user&&a.user.email_confirmed_at&&(await f(a.user),c(!1),p(null))}catch(e){throw console.error("Signup error:",e),Error(e.message||"Error al crear la cuenta")}},[f]),y=(0,s.useCallback)((e,t)=>{r&&(o(r=>{if(!r)return null;let a={...r,subscriptionType:e,subscriptionEndDate:t||null};return i.N.from("users").update({subscription_tier:e,subscription_status:"free"===e?"free":"active"}).eq("id",r.id).then(e=>{let{error:t}=e;t&&console.error("Error updating subscription:",t)}),a}),window.dispatchEvent(new CustomEvent("subscriptionUpdated",{detail:{subscriptionType:e,endDate:t}})))},[r]),w=(0,s.useCallback)(()=>{c(!1),p(null)},[]),S=(0,s.useCallback)(e=>{if(!r)return 0;let t=new Date().toISOString().split("T")[0];return r.dailyUsage.date!==t?(o(e=>e?{...e,dailyUsage:{date:t,aiRequests:0,promptsUsed:0,scriptsGenerated:0}}:null),r.dailyLimits[e]):Math.max(0,r.dailyLimits[e]-r.dailyUsage[e])},[r]),E=(0,s.useCallback)(e=>{if(!r)return;let t=new Date().toISOString().split("T")[0];o(r=>r?r.dailyUsage.date!==t?{...r,dailyUsage:{date:t,aiRequests:+("aiRequests"===e),promptsUsed:+("promptsUsed"===e),scriptsGenerated:+("scriptsGenerated"===e)}}:{...r,dailyUsage:{...r.dailyUsage,[e]:r.dailyUsage[e]+1}}:null)},[r]),N=(0,s.useCallback)(e=>{if(!r)return!1;if("free"!==r.subscriptionType)return!0;let t=new Date().toISOString().split("T")[0];return r.dailyUsage.date!==t||r.dailyUsage[e]<r.dailyLimits[e]},[r]);return(0,a.jsx)(n.Provider,{value:{user:r,loading:l,isAuthenticated:!!r,needsEmailVerification:d,pendingVerificationEmail:m,login:x,logout:b,signup:v,hasActiveSubscription:h,getRemainingSubscriptionDays:g,updateSubscriptionStatus:y,clearEmailVerification:w,getRemainingUsage:S,incrementUsage:E,canUseFeature:N},children:t})},l=()=>{let e=(0,s.useContext)(n);if(void 0===e)throw Error("useAuth debe ser usado dentro de un AuthProvider");return e}},9436:(e,t,r)=>{r.d(t,{dj:()=>m,oR:()=>c});var a=r(12115);let s=0,i=new Map,n=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],u={toasts:[]};function d(e){u=o(u,e),l.forEach(e=>{e(u)})}function c(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:r});return d({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function m(){let[e,t]=a.useState(u);return a.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},18949:(e,t,r)=>{r.d(t,{$:()=>u,r:()=>l});var a=r(95155),s=r(12115),i=r(99708),n=r(74466),o=r(74143);let l=(0,n.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:u=!1,...d}=e,c=u?i.DX:"button";return(0,a.jsx)(c,{className:(0,o.cn)(l({variant:s,size:n,className:r})),ref:t,...d})});u.displayName="Button"},23409:(e,t,r)=>{r.d(t,{o:()=>m});var a=r(95155),s=r(12115),i=r(8794),n=r(18949),o=r(9436),l=r(28883),u=r(53904),d=r(54416),c=r(93536);function m(){let{needsEmailVerification:e,pendingVerificationEmail:t,clearEmailVerification:r}=(0,i.A)(),{toast:m}=(0,o.dj)(),[p,f]=s.useState(!1);if(!e||!t)return null;let h=async()=>{f(!0);try{let{error:e}=await c.N.auth.resend({type:"signup",email:t});if(e)throw e;m({title:"\uD83D\uDCE7 Email reenviado",description:"Hemos enviado un nuevo enlace de verificaci\xf3n a tu correo.",duration:5e3})}catch(e){console.error("Error resending email:",e),m({variant:"destructive",title:"Error al reenviar",description:"No pudimos reenviar el email. Int\xe9ntalo de nuevo m\xe1s tarde."})}finally{f(!1)}};return(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(l.A,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-blue-900 mb-1",children:"\uD83D\uDCE7 Verifica tu direcci\xf3n de email"}),(0,a.jsxs)("p",{className:"text-sm text-blue-700 mb-3",children:["Hemos enviado un enlace de verificaci\xf3n a"," ",(0,a.jsx)("span",{className:"font-medium",children:t}),". Haz clic en el enlace para activar tu cuenta."]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,a.jsx)(n.$,{variant:"outline",size:"sm",onClick:h,disabled:p,className:"text-blue-700 border-blue-300 hover:bg-blue-100",children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Reenviando..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Reenviar email"]})}),(0,a.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:r,className:"text-blue-700 hover:bg-blue-100",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Cerrar"]})]}),(0,a.jsxs)("p",{className:"text-xs text-blue-600 mt-2",children:["\uD83D\uDCA1 ",(0,a.jsx)("strong",{children:"Tip:"})," Si no ves el email, revisa tu carpeta de spam o correo no deseado"]})]})]})})}},56201:(e,t,r)=>{r.d(t,{J:()=>u});var a=r(95155),s=r(12115),i=r(40968),n=r(74466),o=r(74143);let l=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(i.b,{ref:t,className:(0,o.cn)(l(),r),...s})});u.displayName=i.b.displayName},74143:(e,t,r)=>{r.d(t,{Y:()=>o,cn:()=>i,v4:()=>n});var a=r(52596),s=r(39688);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function o(e){return e.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}},86371:(e,t,r)=>{r.d(t,{p:()=>n});var a=r(95155),s=r(12115),i=r(74143);let n=s.forwardRef((e,t)=>{let{className:r,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:(0,i.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...n})});n.displayName="Input"},93536:(e,t,r)=>{r.d(t,{N:()=>n});var a=r(34060);let s="https://rokloeobzlahqyupyjnu.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJva2xvZW9iemxhaHF5dXB5am51Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg3Mjc3ODgsImV4cCI6MjA2NDMwMzc4OH0.abQNOIdUlu2JtrsNcfhaZFhM8t7ZhNEo-Dri1H0IBOc";if(!s||!i)throw Error("Supabase environment variables NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are missing. Please check your .env file or environment configuration.");let n=(0,a.UU)(s,i)}}]);