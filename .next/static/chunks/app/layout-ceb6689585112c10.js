(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{8794:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,AuthProvider:()=>o});var a=r(95155),s=r(12115),i=r(93536);let l=(0,s.createContext)(void 0),o=e=>{let{children:t}=e,[r,o]=(0,s.useState)(null),[n,u]=(0,s.useState)(!0),[c,d]=(0,s.useState)(!1),[m,h]=(0,s.useState)(null);console.log("AuthProvider: Rendering with loading:",n,"user:",r?"exists":"null");let p=(0,s.useCallback)(async e=>{try{let r;u(!0);let{data:a,error:s}=await i.N.from("users").select("*").eq("id",e.id).single();if(s&&"PGRST116"!==s.code)return void console.error("Error loading profile:",s);if(a)r=a;else{var t;let a={id:e.id,email:e.email,full_name:(null==(t=e.user_metadata)?void 0:t.full_name)||e.email.split("@")[0],subscription_tier:"free",subscription_status:"free",subscription_end_date:null},{data:s,error:l}=await i.N.from("users").insert(a).select().single();if(l)return void console.error("Error creating profile:",l);r=s}let l={id:r.id,email:r.email,name:r.full_name,subscriptionType:r.subscription_tier,subscriptionEndDate:r.subscription_end_date?new Date(r.subscription_end_date):null,dailyUsage:{date:new Date().toISOString().split("T")[0],aiRequests:0,promptsUsed:0,scriptsGenerated:0},dailyLimits:{aiRequests:100,promptsUsed:20,scriptsGenerated:5}};o(l)}catch(e){console.error("Error in loadUserProfile:",e),o(null)}finally{u(!1)}},[]);(0,s.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("demo_auth"),t=localStorage.getItem("demo_user");if("true"===e&&t)try{let e=JSON.parse(t);o(e),u(!1),console.log("AuthProvider: Demo mode initialized with user:",e);return}catch(e){console.error("Error parsing demo user:",e),localStorage.removeItem("demo_auth"),localStorage.removeItem("demo_user")}let{data:{session:r}}=await i.N.auth.getSession();if(null==r?void 0:r.user)try{await p(r.user)}catch(e){console.error("Error loading user profile on session check:",e)}}catch(e){console.error("Error initializing auth:",e)}finally{u(!1)}})();let{data:{subscription:e}}=i.N.auth.onAuthStateChange(async(e,t)=>{if("SIGNED_IN"===e&&(null==t?void 0:t.user))try{await p(t.user),d(!1),h(null)}catch(e){console.error("Error loading user profile on auth change:",e)}else"SIGNED_OUT"===e&&(o(null),d(!1),h(null))});return()=>e.unsubscribe()},[p]);let g=(0,s.useCallback)(()=>!!r&&("free"===r.subscriptionType||!r.subscriptionEndDate||new Date<r.subscriptionEndDate),[r]),f=(0,s.useCallback)(()=>{if(!r||!r.subscriptionEndDate)return 0;let e=new Date;return Math.max(0,Math.ceil((r.subscriptionEndDate.getTime()-e.getTime())/864e5))},[r]),b=(0,s.useCallback)(async(e,t)=>{try{let{data:r,error:a}=await i.N.auth.signInWithPassword({email:e,password:t});if(a){if(a.message.includes("Email not confirmed"))throw d(!0),h(e),Error("Email not confirmed");if(a.message.includes("Invalid login credentials"))throw Error("Invalid login credentials");throw a}r.user&&(d(!1),h(null),await p(r.user))}catch(e){throw console.error("Login error:",e),Error(e.message||"Error al iniciar sesi\xf3n")}},[p]),y=(0,s.useCallback)(async()=>{try{let e=localStorage.getItem("demo_auth");if("true"===e){localStorage.removeItem("demo_auth"),localStorage.removeItem("demo_user"),o(null);return}let{error:t}=await i.N.auth.signOut();if(t)throw t;o(null)}catch(e){throw console.error("Logout error:",e),Error(e.message||"Error al cerrar sesi\xf3n")}},[]),v=(0,s.useCallback)(async(e,t,r)=>{try{let{data:a,error:s}=await i.N.auth.signUp({email:e,password:t,options:{data:{full_name:r}}});if(s)throw s;console.log("Signup successful, verification email sent to:",e),d(!0),h(e),a.user&&a.user.email_confirmed_at&&(await p(a.user),d(!1),h(null))}catch(e){throw console.error("Signup error:",e),Error(e.message||"Error al crear la cuenta")}},[p]),E=(0,s.useCallback)((e,t)=>{r&&(o(r=>{if(!r)return null;let a={...r,subscriptionType:e,subscriptionEndDate:t||null};return i.N.from("users").update({subscription_tier:e,subscription_status:"free"===e?"free":"active"}).eq("id",r.id).then(e=>{let{error:t}=e;t&&console.error("Error updating subscription:",t)}),a}),window.dispatchEvent(new CustomEvent("subscriptionUpdated",{detail:{subscriptionType:e,endDate:t}})))},[r]),w=(0,s.useCallback)(()=>{d(!1),h(null)},[]),_=(0,s.useCallback)(e=>{if(!r)return 0;let t=new Date().toISOString().split("T")[0];return r.dailyUsage.date!==t?(o(e=>e?{...e,dailyUsage:{date:t,aiRequests:0,promptsUsed:0,scriptsGenerated:0}}:null),r.dailyLimits[e]):Math.max(0,r.dailyLimits[e]-r.dailyUsage[e])},[r]),I=(0,s.useCallback)(e=>{if(!r)return;let t=new Date().toISOString().split("T")[0];o(r=>r?r.dailyUsage.date!==t?{...r,dailyUsage:{date:t,aiRequests:+("aiRequests"===e),promptsUsed:+("promptsUsed"===e),scriptsGenerated:+("scriptsGenerated"===e)}}:{...r,dailyUsage:{...r.dailyUsage,[e]:r.dailyUsage[e]+1}}:null)},[r]),S=(0,s.useCallback)(e=>{if(!r)return!1;if("free"!==r.subscriptionType)return!0;let t=new Date().toISOString().split("T")[0];return r.dailyUsage.date!==t||r.dailyUsage[e]<r.dailyLimits[e]},[r]);return(0,a.jsx)(l.Provider,{value:{user:r,loading:n,isAuthenticated:!!r,needsEmailVerification:c,pendingVerificationEmail:m,login:b,logout:y,signup:v,hasActiveSubscription:g,getRemainingSubscriptionDays:f,updateSubscriptionStatus:E,clearEmailVerification:w,getRemainingUsage:_,incrementUsage:I,canUseFeature:S},children:t})},n=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth debe ser usado dentro de un AuthProvider");return e}},19324:()=>{},29840:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c"}},36890:(e,t,r)=>{"use strict";r.d(t,{D:()=>o,ThemeProvider:()=>l});var a=r(95155),s=r(12115);let i=(0,s.createContext)({theme:"system",setTheme:()=>null});function l(e){let{children:t,defaultTheme:r="system"}=e,[l,o]=(0,s.useState)(()=>localStorage.getItem("theme")||r);return(0,s.useEffect)(()=>{let e=window.document.documentElement;if(e.classList.remove("light","dark","brutal"),"system"===l){let t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";e.classList.add(t);return}e.classList.add(l)},[l]),(0,a.jsx)(i.Provider,{value:{theme:l,setTheme:e=>{localStorage.setItem("theme",e),o(e)}},children:t})}let o=()=>{let e=(0,s.useContext)(i);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},82024:(e,t,r)=>{Promise.resolve().then(r.bind(r,8794)),Promise.resolve().then(r.t.bind(r,19324,23)),Promise.resolve().then(r.bind(r,36890)),Promise.resolve().then(r.t.bind(r,29840,23))},93536:(e,t,r)=>{"use strict";r.d(t,{N:()=>l});var a=r(34060);let s="https://rokloeobzlahqyupyjnu.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJva2xvZW9iemxhaHF5dXB5am51Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg3Mjc3ODgsImV4cCI6MjA2NDMwMzc4OH0.abQNOIdUlu2JtrsNcfhaZFhM8t7ZhNEo-Dri1H0IBOc";if(!s||!i)throw Error("Supabase environment variables NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are missing. Please check your .env file or environment configuration.");let l=(0,a.UU)(s,i)}},e=>{var t=t=>e(e.s=t);e.O(0,[385,60,441,684,358],()=>t(82024)),_N_E=e.O()}]);